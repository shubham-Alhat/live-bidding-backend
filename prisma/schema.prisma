generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}



model User {
    id String @id @default(cuid())
    username String
    email String @unique
    password String 
    products Product[] @relation("products-own-by-User")
    auctions Auction[] @relation("auctionUserOwns")
    winningAuctions Auction[] @relation("userWhoWonThisAuction")
    bids Bid[] @relation("userWhoBid")
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}
enum PRODUCTSTATUS {
    LIVE
    NOTLIVE
    ARCHIVE
}

model Product {
    id String @id @default(cuid())
    name String
    image String
    status PRODUCTSTATUS @default(NOTLIVE)
    ownerId String
    owner User @relation("products-own-by-User", fields:[ownerId], references:[id])
    auctions Auction[] @relation("auctionThisProductBelongsTo")              
    initialPrice Decimal 
    durationInSeconds Int
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}


model Bid {
    id String @id @default(cuid())
    price Decimal
    bidderId String
    bidder User @relation("userWhoBid",fields:[bidderId],references:[id])
    auctionId String
    auction Auction @relation("bidsInAuction",fields:[auctionId],references:[id])
    winningAuction Auction? @relation("winningBid")
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

enum STATUS {
    
    ACTIVE
    ENDED
    
}


model Auction {
    id String @id @default(cuid())
    ownerId String
    owner User @relation("auctionUserOwns",fields:[ownerId],references:[id])
    winnerId String?
    winner User? @relation("userWhoWonThisAuction",fields:[winnerId], references:[id])
    winningBidId String? @unique //  Added @unique since one auction = one winning bid
    winningBid Bid? @relation("winningBid",fields:[winningBidId], references:[id])
    biddings Bid[] @relation("bidsInAuction")
    productId String
    product Product @relation("auctionThisProductBelongsTo", fields:[productId],references:[id])
    startTime DateTime?
    endTime DateTime?
    auctionDuration Int
    startingPrice Decimal
    finalBidPrice Decimal?
    status STATUS @default(ACTIVE) 
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}